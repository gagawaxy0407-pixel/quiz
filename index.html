<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è£œå……å“å°æ¸¬é©—ï½œåƒMBTIä¸€æ¨£å¥½ç©</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#121b2e;
      --card2:#0f1729;
      --txt:#e9eefc;
      --muted:#a9b5d6;
      --line:#223055;
      --accent:#7c5cff;
      --accent2:#1ee3cf;
      --warn:#ffcc66;
      --ok:#7dff9e;
      --danger:#ff6b7a;
      --shadow: 0 18px 40px rgba(0,0,0,.35);
      --r: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,92,255,.22), transparent 60%),
                  radial-gradient(900px 500px at 90% 20%, rgba(30,227,207,.18), transparent 55%),
                  linear-gradient(180deg, #070b14, var(--bg));
      color:var(--txt);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 14px;
    }
    a{color:inherit}
    .wrap{width:min(980px, 100%);}
    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; margin-bottom:16px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:46px; height:46px; border-radius:14px;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(30,227,207,.9));
      box-shadow: 0 12px 30px rgba(124,92,255,.25);
      display:grid; place-items:center;
      position:relative; overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-30px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 50%);
      transform: rotate(22deg);
    }
    .logo span{font-size:22px; position:relative}
    .title h1{margin:0; font-size:18px; letter-spacing:.2px}
    .title p{margin:2px 0 0; color:var(--muted); font-size:13px}
    .pill{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.09);
      padding:10px 12px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      display:flex; align-items:center; gap:8px;
    }
    .pill b{color:var(--txt); font-weight:700}
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns:1fr;}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .inner{padding:18px;}
    .progress{
      height:10px; background: rgba(255,255,255,.08);
      border-radius:999px; overflow:hidden;
      border:1px solid rgba(255,255,255,.09);
      margin-bottom:14px;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius:999px;
      transition: width .35s ease;
    }
    .qtop{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
    .qmeta{color:var(--muted); font-size:12px; margin:0 0 6px}
    .qtext{margin:0 0 14px; font-size:20px; line-height:1.25}
    .avatar{
      width:96px; height:96px; border-radius:24px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.2), transparent 55%),
                  linear-gradient(135deg, rgba(124,92,255,.22), rgba(30,227,207,.14));
      border:1px solid rgba(255,255,255,.10);
      display:grid; place-items:center;
      font-size:48px;
      flex: 0 0 auto;
      transform: rotate(-2deg);
    }

    .answers{display:grid; gap:10px; margin-top:10px;}
    .btn{
      width:100%;
      text-align:left;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--txt);
      padding:14px 14px;
      border-radius: 16px;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .btn:hover{
      background: rgba(255,255,255,.09);
      border-color: rgba(255,255,255,.16);
      transform: translateY(-1px);
    }
    .btn:active{transform: translateY(0px) scale(.995);}
    .optTag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(124,92,255,.18);
      border:1px solid rgba(124,92,255,.24);
      color:#d8d2ff;
      white-space:nowrap;
    }

    .side{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .side h3{margin:0 0 8px; font-size:14px; color:var(--muted); font-weight:600;}
    .chipRow{display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 16px;}
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.09);
      font-size:12px;
      color:var(--muted);
    }
    .mini{
      display:grid; gap:10px;
      padding:14px;
      border-radius:16px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
    }
    .mini strong{font-size:14px;}
    .mini p{margin:0; color:var(--muted); font-size:12px; line-height:1.45}

    .navRow{display:flex; gap:10px; margin-top:14px;}
    .ghost{
      background: transparent;
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted);
    }
    .primary{
      background: linear-gradient(90deg, rgba(124,92,255,.95), rgba(30,227,207,.8));
      border: none;
      box-shadow: 0 14px 30px rgba(124,92,255,.20);
    }
    .primary .optTag{
      background: rgba(255,255,255,.18);
      border-color: rgba(255,255,255,.22);
      color: rgba(10,15,30,.9);
      font-weight:700;
    }

    /* Result */
    .resultHero{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      padding:18px;
      background: linear-gradient(135deg, rgba(124,92,255,.18), rgba(30,227,207,.12));
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .resultHero h2{margin:0; font-size:18px;}
    .badge{
      padding:8px 10px; border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      color:var(--txt);
      font-size:12px;
      white-space:nowrap;
    }
    .stack{display:grid; gap:10px; margin-top:14px;}
    .prod{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      padding:14px;
      border-radius:16px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.09);
    }
    .prod .left{display:flex; gap:12px; align-items:flex-start;}
    .prod .ico{
      width:44px; height:44px; border-radius:14px;
      display:grid; place-items:center; font-size:22px;
      background: rgba(124,92,255,.16);
      border:1px solid rgba(124,92,255,.22);
    }
    .prod h4{margin:0; font-size:15px;}
    .prod p{margin:4px 0 0; color:var(--muted); font-size:12px; line-height:1.45;}
    .prod .right{
      text-align:right;
      display:grid; gap:4px;
      white-space:nowrap;
    }
    .money{font-weight:800;}
    .small{color:var(--muted); font-size:12px;}
    table{
      width:100%;
      border-collapse: collapse;
      margin-top:12px;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
    }
    th,td{padding:10px 10px; font-size:12px; border-bottom:1px solid rgba(255,255,255,.06);}
    th{color:var(--muted); text-align:left; font-weight:600;}
    tr:last-child td{border-bottom:none;}
    .subscribe{
      display:grid; gap:10px;
      margin-top:14px;
      padding:14px;
      border-radius:16px;
      background: rgba(0,0,0,.16);
      border:1px solid rgba(255,255,255,.08);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap;}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--txt);
      outline:none;
    }
    input::placeholder{color: rgba(233,238,252,.45);}
    .note{
      color:var(--muted);
      font-size:12px; line-height:1.45;
      margin:10px 0 0;
    }
    .toast{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(125,255,158,.22);
      background: rgba(125,255,158,.10);
      color: rgba(230,255,240,.92);
      font-size:12px;
      display:none;
    }
    .shake{
      animation: shake .35s ease;
    }
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(-6px)}
      50%{transform:translateX(6px)}
      75%{transform:translateX(-3px)}
      100%{transform:translateX(0)}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo"><span>ğŸ§ª</span></div>
        <div class="title">
          <h1>è£œå……å“å°éŠæˆ²ï¼ˆåƒ MBTI ä¸€æ¨£ï¼‰</h1>
          <p>10 é¡Œè§£é–ä½ çš„ã€Œè£œçµ¦è§’è‰²ã€ï¼‹æ¯æ—¥è£œå……æ–¹æ¡ˆï¼†è²»ç”¨</p>
        </div>
      </div>
      <div class="pill">
        <span>ç›®å‰é¡Œæ•¸</span> <b id="pillCount">1 / 10</b> <span>ï½œ</span> <span id="pillHint">é¸ä¸€å€‹æœ€åƒä½ çš„</span>
      </div>
    </header>

    <div class="grid">
      <!-- Main -->
      <section class="card">
        <div class="inner" id="main"></div>
      </section>

      <!-- Side -->
      <aside class="card side">
        <div class="inner">
          <h3>ä½ çš„ã€Œè£œçµ¦é›·é”ã€æ­£åœ¨æƒæâ€¦</h3>
          <div class="chipRow" id="chips"></div>

          <div class="mini">
            <strong>ç©æ³•æç¤º</strong>
            <p>åƒç©å¿ƒç†æ¸¬é©—ï¼šä¸è¦æƒ³å¤ªä¹…ï¼Œé¸ã€Œæœ€ç¬¦åˆä½ ç¾åœ¨ç‹€æ…‹ã€çš„ç­”æ¡ˆã€‚</p>
          </div>

          <div class="mini" style="margin-top:12px;">
            <strong>åˆè¦å°å­—ï¼ˆå¯è‡ªè¡Œæ”¹ï¼‰</strong>
            <p>æœ¬æ¸¬é©—åƒ…ä¾›ç”Ÿæ´»é¢¨æ ¼åƒè€ƒï¼Œéé†«ç™‚å»ºè­°ã€‚è‹¥æœ‰æ…¢æ€§ç—…ã€æ‡·å­•å“ºä¹³æˆ–æ­£åœ¨ç”¨è—¥ï¼Œè«‹å…ˆè«®è©¢å°ˆæ¥­äººå“¡ã€‚</p>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    /***********************
     * 1) ç”¢å“è¨­å®šï¼ˆå¯æ”¹åƒ¹æ ¼/ç”¨é‡ï¼‰
     ***********************/
    const PRODUCTS = {
      b:   { key:"b",   name:"Bç¾¤",       icon:"âš¡", baseDose:"æ¯æ—¥ 1 ç²’",   unitPrice:12,  desc:"ç†¬å¤œã€å£“åŠ›ã€ç²¾ç¥ç–²å‹ã€æƒ³æ›´æœ‰çºŒèˆªæ„Ÿã€‚" },
      fish:{ key:"fish",name:"é­šæ²¹",       icon:"ğŸŸ", baseDose:"æ¯æ—¥ 1â€“2 ç²’", unitPrice:18,  desc:"å¤–é£Ÿå¤šã€å°‘åƒé­šã€åœ¨æ„å¾ªç’°èˆ‡æ—¥å¸¸ä¿é¤Šã€‚" },
      nmn: { key:"nmn", name:"NMN",        icon:"â³", baseDose:"æ¯æ—¥ 1 ç²’",   unitPrice:45,  desc:"ä½œæ¯äº‚ã€ç²¾åŠ›æ˜“è¦‹åº•ã€æƒ³åšé•·ç·šç‹€æ…‹ç®¡ç†ã€‚" },
      bitter:{key:"bitter",name:"è‹¦ç“œèƒœè‚½",icon:"ğŸ¥’", baseDose:"æ¯æ—¥ 1â€“2 ç²’", unitPrice:20,  desc:"æ‰‹æ–/æ¾±ç²‰å¤šã€é£¯å¾Œæƒ³æ›´ç©©ã€åœ¨æ„ä»£è¬ç®¡ç†ã€‚" },
      enzyme:{key:"enzyme",name:"é…µç´ éŒ ",  icon:"ğŸ", baseDose:"é¤å¾Œ 1â€“2 éŒ ", unitPrice:10,  desc:"èšé¤å¤šã€æ¶ˆåŒ–å¡å¡ã€é£¯å¾Œå®¹æ˜“è„¹ã€‚" },
      liver:{key:"liver",name:"è­·è‚",      icon:"ğŸ›¡ï¸", baseDose:"æ¯æ—¥ 1 ç²’",   unitPrice:22,  desc:"æ‡‰é…¬/ç†¬å¤œå¤šã€å¸¸å–é…’ã€éš”å¤©å®¹æ˜“ç–²å€¦ã€‚" },
    };

    // ä½ æƒ³è¦ã€Œä¸€å¤©å¤šå°‘éŒ¢ã€ï¼šé€™è£¡ç”¨ unitPrice ç•¶ä½œã€Œå»ºè­°æ–¹æ¡ˆçš„å¹³å‡æ¯æ—¥æˆæœ¬ï¼ˆä½ å¯æ”¹æˆæ›´çœŸå¯¦çš„è¨ˆåƒ¹ï¼‰ã€ã€‚

    /***********************
     * 2) é¡Œåº«ï¼š10é¡Œï¼Œæ¯é¡Œ4é¸é …
     * æ¯å€‹é¸é …éƒ½æœƒå°ç”¢å“åŠ æ¬Šï¼ˆscoreï¼‰
     ***********************/
    const QUESTIONS = [
      {
        avatar:"ğŸ¦¦", // å¯æ„›è§’è‰²ï¼šæ¯é¡Œä¸åŒä¹Ÿå¯ä»¥
        q:"ä½ å¹³å¸¸å¤§æ¦‚å¹¾é»ç¡ï¼Ÿ",
        opts:[
          {t:"22:30 å‰ï¼Œæˆ‘æ˜¯æ—©ç¡æ´¾", tag:"ä½œæ¯å¤©ä½¿", score:{fish:1}},
          {t:"23:00â€“00:30ï¼Œæ­£å¸¸ç¯„åœ", tag:"ä¸­æ€§", score:{b:1, fish:1}},
          {t:"01:00â€“02:30ï¼Œç†¬å¤œå¸¸æ…‹", tag:"å¤œè²“", score:{b:2, liver:1}},
          {t:"03:00 å¾Œâ€¦æˆ‘åœ¨è·Ÿä¸–ç•Œæ‹”æ²³", tag:"çˆ†è‚æˆ°å£«", score:{b:3, liver:2, nmn:1}},
        ]
      },
      {
        avatar:"ğŸ¼",
        q:"ä½ æœƒä¸æœƒç¡ç¡é†’é†’ã€æ·ºçœ ï¼Ÿ",
        opts:[
          {t:"å¹¾ä¹ä¸æœƒï¼Œä¸€è¦ºåˆ°å¤©äº®", tag:"ç¡ç¥", score:{fish:1}},
          {t:"å¶çˆ¾é†’ä¸€ä¸‹ä½†èƒ½å†ç¡", tag:"å¯æ§", score:{fish:1, b:1}},
          {t:"å¸¸é†’ã€è…¦è¢‹åœä¸ä¸‹ä¾†", tag:"ç„¦æ…®è…¦", score:{b:2, nmn:1}},
          {t:"é†’ä¾†é‚„æœƒæ»‘æ‰‹æ©Ÿåˆ°å¤©äº®", tag:"æ‰‹æ©Ÿç¶æ¶", score:{b:2, nmn:2}},
        ]
      },
      {
        avatar:"ğŸ¦Š",
        q:"ä½ æ—©ä¸Šèµ·åºŠçš„æ„Ÿè¦ºæ¯”è¼ƒåƒï¼Ÿ",
        opts:[
          {t:"é†’ä¾†å°±èƒ½é–‹æ©Ÿ", tag:"ç§’é–‹æ©Ÿ", score:{fish:1}},
          {t:"éœ€è¦å’–å•¡/èŒ¶æ‰èƒ½åšäºº", tag:"å’–å•¡çºŒå‘½", score:{b:2}},
          {t:"åƒè¢«å¡è»Šè¼¾é", tag:"é›»é‡0%", score:{b:2, liver:1}},
          {t:"æ˜æ˜ç¡äº†é‚„æ˜¯å¾ˆè€—", tag:"é•·æœŸè€—æ", score:{nmn:2, b:1}},
        ]
      },
      {
        avatar:"ğŸ°",
        q:"ä½ æœ€å¸¸é‡åˆ°çš„é£²é£Ÿæƒ…å¢ƒæ˜¯ï¼Ÿ",
        opts:[
          {t:"è‡ªç…®/æ¸…æ·¡å±…å¤š", tag:"è‡ªå¾‹å‹", score:{fish:1}},
          {t:"å¤–é£Ÿä¾¿ç•¶å¤šã€èœå°‘", tag:"å¤–é£Ÿæ—", score:{fish:2, b:1}},
          {t:"æ¾±ç²‰+æ‰‹æ–å¾ˆå¸¸è¦‹", tag:"ç³–æ¾±ç²‰é»¨", score:{bitter:3}},
          {t:"èšé¤æ‡‰é…¬å¤šã€å¸¸æ™šé¤å¾ˆæ™š", tag:"ç¤¾äº¤èƒƒ", score:{enzyme:2, liver:1}},
        ]
      },
      {
        avatar:"ğŸ¦",
        q:"ä½ é£¯å¾Œæœ€å¸¸å‡ºç¾çš„ç‹€æ³ï¼Ÿ",
        opts:[
          {t:"æ²’ä»€éº¼æ„Ÿè¦º", tag:"å¹³ç©©", score:{fish:1}},
          {t:"å®¹æ˜“è„¹ã€æ‰“å—ã€å¡å¡", tag:"æ¶ˆåŒ–å¡", score:{enzyme:3}},
          {t:"åƒå®Œæƒ³èººï¼Œæ˜æ˜æ¬²ç¡", tag:"é£¯å¾Œç•¶æ©Ÿ", score:{bitter:2, b:1}},
          {t:"é‡å£å‘³å¾Œéš”å¤©å¾ˆç–²æ†Š", tag:"ä»£åƒ¹æ´¾", score:{liver:2, enzyme:1}},
        ]
      },
      {
        avatar:"ğŸ¯",
        q:"ä½ ä¸€é€±å–é…’/æ‡‰é…¬å¤§æ¦‚ï¼Ÿ",
        opts:[
          {t:"å¹¾ä¹ä¸å–", tag:"æ¸…é†’æ´¾", score:{fish:1}},
          {t:"1 æ¬¡å·¦å³", tag:"å¶çˆ¾", score:{liver:1}},
          {t:"2â€“3 æ¬¡", tag:"ç¤¾äº¤å‹", score:{liver:2, b:1}},
          {t:"4 æ¬¡ä»¥ä¸Šï¼ˆæˆ–ä½ ä¸æƒ³ç®—ï¼‰", tag:"ç¡¬æ‰›å‹", score:{liver:3, b:2}},
        ]
      },
      {
        avatar:"ğŸ¦„",
        q:"ä½ æœ€è¿‘çš„ç‹€æ…‹æ¯”è¼ƒåƒå“ªä¸€å¥ï¼Ÿ",
        opts:[
          {t:"è…¦è¢‹å¾ˆæ¸…æ¥šï¼Œä½†èº«é«”è·Ÿä¸ä¸Š", tag:"èº«å¿ƒè½å·®", score:{nmn:2}},
          {t:"äº‹æƒ…ä¸€å¤šå°±å¾ˆç…©ã€å¾ˆç‡¥", tag:"å£“åŠ›å±±å¤§", score:{b:3}},
          {t:"æƒ³é¡§é•·ç·šç‹€æ…‹ï¼Œä½†æ‡¶å¾—è¤‡é›œ", tag:"é•·ç·šç©å®¶", score:{nmn:2, fish:1}},
          {t:"æˆ‘åªæ˜¯æƒ³ä¸è¦é‚£éº¼ç´¯", tag:"æ±‚æ•‘è¨Šè™Ÿ", score:{b:2, liver:1, nmn:1}},
        ]
      },
      {
        avatar:"ğŸ»",
        q:"ä½ çš„æ—¥å¸¸æ´»å‹•æ¯”è¼ƒåï¼Ÿ",
        opts:[
          {t:"ä¹…åä¸Šç­/é€šå‹¤å¤š", tag:"ä¹…å", score:{fish:2}},
          {t:"å¸¸ç”¨è…¦ã€æœƒçˆ†è‚è¶•é€²åº¦", tag:"è…¦åŠ›å£“æ¦¨", score:{b:2, nmn:1}},
          {t:"è¼ªç­/æ—¥å¤œé¡›å€’", tag:"æ™‚å·®äººç”Ÿ", score:{b:2, liver:1, nmn:2}},
          {t:"å¸¸è·‘æ¥­å‹™/ç¤¾äº¤å¾ˆå¤š", tag:"ç¤¾äº¤æˆ°å£«", score:{liver:2, b:1}},
        ]
      },
      {
        avatar:"ğŸ§",
        q:"ä½ æœ€æƒ³æ”¹å–„çš„ç¬¬ä¸€åæ˜¯ï¼Ÿ",
        opts:[
          {t:"ç²¾ç¥çºŒèˆªï¼ˆä¸è¦ä¸‹åˆæ­»æ©Ÿï¼‰", tag:"çºŒèˆª", score:{b:3}},
          {t:"å¾ªç’°ä¿é¤Šï¼ˆå°‘åƒé­šçš„ç½ªæƒ¡æ„Ÿï¼‰", tag:"å¾ªç’°", score:{fish:3}},
          {t:"ä»£è¬ç®¡ç†ï¼ˆç”œé£Ÿæ¾±ç²‰å¥½é›£æˆ’ï¼‰", tag:"ä»£è¬", score:{bitter:3}},
          {t:"æ¶ˆåŒ–é †ï¼ˆé£¯å¾Œä¸è¦å†è…«ä¸€åœˆï¼‰", tag:"æ¶ˆåŒ–", score:{enzyme:3}},
        ]
      },
      {
        avatar:"ğŸ¦‰",
        q:"æœ€å¾Œä¸€é¡Œï¼šä½ é¡˜æ„çš„è£œå……æ–¹å¼ï¼Ÿ",
        opts:[
          {t:"è¶Šå°‘é¡†è¶Šå¥½", tag:"æ¥µç°¡æ´¾", score:{nmn:1, fish:1}},
          {t:"å¯ä»¥ 2â€“3 ç¨®ï¼Œæ•ˆæœè¦æœ‰æ„Ÿ", tag:"å¹³è¡¡æ´¾", score:{b:1, fish:1, enzyme:1}},
          {t:"æˆ‘é¡˜æ„ç…§è¡¨æ“èª²", tag:"èªçœŸæ´¾", score:{b:2, fish:1, bitter:1, liver:1}},
          {t:"æˆ‘éœ€è¦æœ‰äººå¹«æˆ‘é…å¥½å¯„ä¾†", tag:"è¨‚é–±æ´¾", score:{b:1, fish:1, nmn:1, bitter:1, enzyme:1, liver:1}},
        ]
      },
    ];

    /***********************
     * 3) éŠæˆ²ç‹€æ…‹
     ***********************/
    let idx = 0;
    let scores = Object.fromEntries(Object.keys(PRODUCTS).map(k => [k, 0]));
    let picked = []; // è¿½è¹¤é¸äº†ä»€éº¼ï¼Œæ–¹ä¾¿æ—¥å¾Œåšå›é¡§/å°è³¼æ–‡æ¡ˆ

    const main = document.getElementById("main");
    const chips = document.getElementById("chips");
    const pillCount = document.getElementById("pillCount");

    function renderChips(){
      // é¡¯ç¤ºç›®å‰å‰3åé›·é”
      const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
      const top = sorted.slice(0,3);
      chips.innerHTML = top.map(([k,v])=>{
        const p = PRODUCTS[k];
        const level = v >= 9 ? "ğŸ”¥" : v >= 6 ? "âœ¨" : v >= 3 ? "ğŸ™‚" : "â€¦";
        return `<span class="chip">${p.icon} ${p.name} ${level}</span>`;
      }).join("");
    }

    function progressPct(){
      return Math.round((idx / QUESTIONS.length) * 100);
    }

    function renderQuestion(){
      const q = QUESTIONS[idx];
      pillCount.textContent = `${idx+1} / ${QUESTIONS.length}`;
      renderChips();

      main.innerHTML = `
        <div class="progress"><div class="bar" style="width:${progressPct()}%"></div></div>
        <div class="qtop">
          <div>
            <p class="qmeta">ç¬¬ ${idx+1} é¡Œï½œé¸ä¸€å€‹æœ€åƒä½ çš„</p>
            <h2 class="qtext">${q.q}</h2>
          </div>
          <div class="avatar" aria-hidden="true">${q.avatar}</div>
        </div>

        <div class="answers">
          ${q.opts.map((o,i)=>`
            <button class="btn" data-i="${i}">
              <span>${o.t}</span>
              <span class="optTag">${o.tag}</span>
            </button>
          `).join("")}
        </div>

        <div class="navRow">
          <button class="btn ghost" id="backBtn" ${idx===0?'disabled':''} style="opacity:${idx===0?.5:1}">
            <span>â¬…ï¸ ä¸Šä¸€é¡Œ</span>
            <span class="optTag">å¯å›é ­</span>
          </button>
          <button class="btn primary" id="skipBtn">
            <span>æˆ‘ä¸ç¢ºå®šï¼ˆè·³éï¼‰</span>
            <span class="optTag">+0 åˆ†</span>
          </button>
        </div>
      `;

      // Bind
      main.querySelectorAll(".btn[data-i]").forEach(btn=>{
        btn.addEventListener("click", ()=> choose(+btn.dataset.i));
      });
      main.querySelector("#skipBtn").addEventListener("click", ()=> choose(null));
      main.querySelector("#backBtn").addEventListener("click", ()=> goBack());
    }

    function applyScore(delta){
      for (const [k,v] of Object.entries(delta || {})){
        if (scores[k] == null) continue;
        scores[k] += v;
      }
    }

    function choose(optIndex){
      const q = QUESTIONS[idx];

      // è¨˜éŒ„é¸æ“‡ä»¥ä¾¿å›ä¸Šä¸€é¡Œå¯å›æ»¾
      let record = { idx, optIndex, delta: null };
      if (optIndex != null){
        record.delta = q.opts[optIndex].score || {};
        applyScore(record.delta);
      }
      picked.push(record);

      idx++;
      if (idx >= QUESTIONS.length){
        renderResult();
      }else{
        renderQuestion();
      }
    }

    function goBack(){
      if (idx <= 0) return;

      // å›åˆ°ä¸Šä¸€é¡Œï¼šå›æ»¾åˆ†æ•¸
      const last = picked.pop();
      if (last && last.delta){
        for (const [k,v] of Object.entries(last.delta)){
          scores[k] -= v;
        }
      }
      idx = Math.max(0, idx-1);
      renderQuestion();
    }

    /***********************
     * 4) çµæœé ï¼šé¸å‰2~4å€‹æ¨è–¦
     ***********************/
    function pickPlan(){
      const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
      const bestScore = sorted[0][1];

      // è‹¥åˆ†æ•¸éƒ½å¾ˆä½ï¼Œä»çµ¦ã€ŒåŸºç¤ä¿é¤Šã€çµ„åˆ
      if (bestScore <= 2){
        return ["b", "fish"];
      }

      // å–å‰3åï¼Œä½†è¦æœ‰åŸºæœ¬é–€æª»
      const top = sorted.filter(([k,v])=>v >= 3).slice(0,4).map(([k])=>k);

      // ä¿åº•è‡³å°‘2å€‹
      if (top.length < 2){
        top.push(sorted[1][0]);
      }
      return Array.from(new Set(top)).slice(0,4);
    }

    function personaLabel(plan){
      // åšå€‹ MBTI-like çš„å¯æ„›ç¨±è™Ÿ
      const has = (k)=> plan.includes(k);
      if (has("liver") && has("b")) return {name:"çˆ†è‚çºŒå‘½å‹", emoji:"ğŸ§Ÿâ€â™€ï¸âš¡"};
      if (has("bitter") && has("enzyme")) return {name:"ç¾é£Ÿä»£è¬å‹", emoji:"ğŸœğŸ¥’"};
      if (has("nmn") && has("fish")) return {name:"é•·ç·šä¿é¤Šå‹", emoji:"â³ğŸŸ"};
      if (has("b") && has("fish")) return {name:"ä¸Šç­çºŒèˆªå‹", emoji:"ğŸ’¼âš¡"};
      return {name:"å‡è¡¡è£œçµ¦å‹", emoji:"ğŸ§ƒâœ¨"};
    }

    function calcDailyCost(plan){
      return plan.reduce((sum,k)=>sum + (PRODUCTS[k].unitPrice || 0), 0);
    }

    function renderResult(){
      const plan = pickPlan();
      const persona = personaLabel(plan);
      const daily = calcDailyCost(plan);
      const monthly = daily * 30;

      pillCount.textContent = `${QUESTIONS.length} / ${QUESTIONS.length}`;
      renderChips();

      const rows = plan.map(k=>{
        const p = PRODUCTS[k];
        return `
          <div class="prod">
            <div class="left">
              <div class="ico">${p.icon}</div>
              <div>
                <h4>${p.name}</h4>
                <p>${p.desc}<br><b style="color:#fff">å»ºè­°ç”¨é‡ï¼š</b>${p.baseDose}</p>
              </div>
            </div>
            <div class="right">
              <div class="money">$${p.unitPrice} / å¤©</div>
              <div class="small">è¨‚é–±å¯è‡ªå‹•è£œè²¨</div>
            </div>
          </div>
        `;
      }).join("");

      const sortedAll = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
      const tableRows = sortedAll.map(([k,v])=>{
        const p = PRODUCTS[k];
        const bar = Math.min(100, v*10);
        return `
          <tr>
            <td>${p.icon} ${p.name}</td>
            <td>${v}</td>
            <td>
              <div style="height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.08);">
                <div style="height:100%;width:${bar}%;background:linear-gradient(90deg, rgba(124,92,255,.9), rgba(30,227,207,.75));"></div>
              </div>
            </td>
          </tr>
        `;
      }).join("");

      main.innerHTML = `
        <div class="resultHero">
          <div>
            <h2>ä½ çš„è§’è‰²æ˜¯ï¼š${persona.emoji}ã€Œ${persona.name}ã€</h2>
            <div class="note">ä»¥ä¸‹ç‚ºç”Ÿæ´»é¢¨æ ¼å»ºè­°ï¼ˆéé†«ç™‚å»ºè­°ï¼‰ã€‚è‹¥ä½ æœ‰ç–¾ç—…ã€æ‡·å­•å“ºä¹³ã€æ­£åœ¨ç”¨è—¥ï¼Œè«‹å…ˆè«®è©¢å°ˆæ¥­äººå“¡ã€‚</div>
          </div>
          <div class="badge">æ¯æ—¥é ä¼°ï¼š<b>$${daily}</b>ï½œ30å¤©ï¼š<b>$${monthly}</b></div>
        </div>

        <div class="inner">
          <h3 style="margin:0 0 6px;color:var(--muted);font-weight:600;">ä½ çš„ã€Œæ¯æ—¥è£œçµ¦æ–¹æ¡ˆã€</h3>
          <div class="stack">${rows}</div>

          <table>
            <thead>
              <tr><th>è£œå……å“é›·é”</th><th>åˆ†æ•¸</th><th>å¼·åº¦</th></tr>
            </thead>
            <tbody>${tableRows}</tbody>
          </table>

          <div class="subscribe">
            <strong>ä¸€éµè¨‚é–±ï¼ˆç¤ºç¯„ç‰ˆï¼‰</strong>
            <div class="row">
              <input id="subName" placeholder="å§“å" style="flex:1; min-width:180px;">
              <input id="subPhone" placeholder="æ‰‹æ©Ÿï¼ˆå¯é¸ï¼‰" style="flex:1; min-width:180px;">
            </div>
            <input id="subAddr" placeholder="å¯„é€åœ°å€ï¼ˆç¤ºç¯„ï¼šå°åŒ—å¸‚â€¦ï¼‰">
            <div class="row">
              <select id="subCycle" style="flex:1; min-width:180px;">
                <option value="30">æ¯ 30 å¤©å¯„ä¸€æ¬¡</option>
                <option value="45">æ¯ 45 å¤©å¯„ä¸€æ¬¡</option>
                <option value="60">æ¯ 60 å¤©å¯„ä¸€æ¬¡</option>
              </select>
              <button class="btn primary" id="subBtn" style="flex:1; min-width:180px;">
                <span>è¨‚é–±ä¸¦å¯„å‡ºæˆ‘çš„æ–¹æ¡ˆ</span>
                <span class="optTag">GO</span>
              </button>
            </div>

            <div class="toast" id="toast">âœ… å·²æ”¶åˆ°è¨‚é–±è³‡æ–™ï¼ˆç¤ºç¯„ï¼‰ã€‚ä½ å¯ä»¥æŠŠé€™è£¡ä¸²æ¥åˆ°å¯¦éš›è¡¨å–®/é‡‘æµ/CRMã€‚</div>
            <div class="note">
              ä½ å¯ä»¥æŠŠã€Œæ¯æ—¥è²»ç”¨ã€æ”¹æˆä¾ç…§ä½ çš„å¯¦éš›å”®åƒ¹/åŒ…è£è¦æ ¼ä¾†ç®—ï¼ˆä¾‹å¦‚ï¼šä¸€ç“¶30ç²’ã€å”®åƒ¹$XXX â†’ æ¯æ—¥æˆæœ¬=å”®åƒ¹/30ï¼‰ã€‚<br>
              æƒ³æ›´åƒ MBTIï¼šå¯ä»¥å†åŠ ã€Œå‰¯çµæœã€æ–‡å­—ï¼Œä¾‹å¦‚ã€Œä½ çš„è‡´å‘½å¼±é»æ˜¯ï¼šæ™šç¡ï¼‹å¤–é£Ÿã€ä¸¦å¸¶å‡ºå°æ‡‰ç”¢å“çµ„åˆã€‚
            </div>

            <div class="navRow" style="margin-top:10px;">
              <button class="btn ghost" id="restartBtn">
                <span>ğŸ”„ å†æ¸¬ä¸€æ¬¡</span>
                <span class="optTag">Reset</span>
              </button>
              <button class="btn" id="copyBtn">
                <span>ğŸ“‹ è¤‡è£½çµæœæ–‡æ¡ˆ</span>
                <span class="optTag">Share</span>
              </button>
            </div>
          </div>
        </div>
      `;

      document.getElementById("subBtn").addEventListener("click", ()=>{
        const name = document.getElementById("subName");
        const addr = document.getElementById("subAddr");
        if(!name.value.trim() || !addr.value.trim()){
          const box = document.querySelector(".subscribe");
          box.classList.remove("shake"); void box.offsetWidth; box.classList.add("shake");
          return;
        }
        document.getElementById("toast").style.display = "block";
      });

      document.getElementById("restartBtn").addEventListener("click", ()=>{
        idx = 0;
        scores = Object.fromEntries(Object.keys(PRODUCTS).map(k => [k, 0]));
        picked = [];
        document.getElementById("pillHint").textContent = "é¸ä¸€å€‹æœ€åƒä½ çš„";
        renderQuestion();
      });

      document.getElementById("copyBtn").addEventListener("click", async ()=>{
        const text = buildShareText(plan, persona, daily);
        try{
          await navigator.clipboard.writeText(text);
          alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
        }catch(e){
          alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š\n\n" + text);
        }
      });
    }

    function buildShareText(plan, persona, daily){
      const items = plan.map(k=>{
        const p = PRODUCTS[k];
        return `- ${p.name}ï¼ˆ${p.baseDose}ï¼‰`;
      }).join("\n");

      return `æˆ‘çš„è£œå……å“è§’è‰²ï¼š${persona.name}\n\næˆ‘çš„æ¯æ—¥è£œçµ¦æ–¹æ¡ˆï¼š\n${items}\n\næ¯æ—¥é ä¼°ï¼š$${daily}/å¤©\nï¼ˆæ­¤ç‚ºç”Ÿæ´»é¢¨æ ¼åƒè€ƒï¼Œéé†«ç™‚å»ºè­°ï¼‰`;
    }

    // init
    renderQuestion();
  </script>
</body>
</html>
